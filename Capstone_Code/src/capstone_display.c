/*
Benjamin Mock
Major revision started 4 December 2025
This is the code to display the message of the device to the display using I2C.
The file was technically created earlier, but contained nothing but a single printf statement
*/
#include "capstone_display.h"
#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include "capstone_morse.h"
#include "capstone_input.h"
#include "usi_i2c.h"

#define CHAR_SIZE 6

uint8_t buffer[6];

const uint8_t ssd1306xled_font6x8 []={
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // space
  0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C, // A
  0x00, 0x7F, 0x49, 0x49, 0x49, 0x36, // B
  0x00, 0x3E, 0x41, 0x41, 0x41, 0x22, // C
  0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C, // D
  0x00, 0x7F, 0x49, 0x49, 0x49, 0x41, // E
  0x00, 0x7F, 0x09, 0x09, 0x09, 0x01, // F
  0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A, // G
  0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F, // H
  0x00, 0x00, 0x41, 0x7F, 0x41, 0x00, // I
  0x00, 0x20, 0x40, 0x41, 0x3F, 0x01, // J
  0x00, 0x7F, 0x08, 0x14, 0x22, 0x41, // K
  0x00, 0x7F, 0x40, 0x40, 0x40, 0x40, // L
  0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F, // M
  0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F, // N
  0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E, // O
  0x00, 0x7F, 0x09, 0x09, 0x09, 0x06, // P
  0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E, // Q
  0x00, 0x7F, 0x09, 0x19, 0x29, 0x46, // R
  0x00, 0x46, 0x49, 0x49, 0x49, 0x31, // S
  0x00, 0x01, 0x01, 0x7F, 0x01, 0x01, // T
  0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F, // U
  0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F, // V
  0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F, // W
  0x00, 0x63, 0x14, 0x08, 0x14, 0x63, // X
  0x00, 0x07, 0x08, 0x70, 0x08, 0x07, // Y
  0x00, 0x61, 0x51, 0x49, 0x45, 0x43, // Z
};

void update_display()
{
/*
	//simulation testing printfs
	printf("Letter: ");
	printf(current_letter);
	printf("\n");

	printf("Message: ");
	printf(message);
	printf("\n");
*/

	if(strlen(message) > 20) {
		strcpy(message, "MSG SIZE ERROR");
		display_message();
		return;
	}
	display_message();

}


void display_message() {
	uint8_t i;
    	uint8_t j;
	uint8_t k;
	uint8_t cursor_col = 0;
	uint8_t len = strlen(message);
	char current_letter;
	for(j=0; j < len; j++) {
		current_letter = message[j];
		for (i = 0; i < 27; i++) {
			if(current_letter == alphabet[i]) {
				for(k=0; k < 6; k++)
					buffer[k] = ssd1306xled_font6x8[CHAR_SIZE*i+k];
				break;
			}
		}
		oled_write_char6(buffer);
		cursor_col = cursor_col + CHAR_SIZE;
		oled_set_cursor(0, cursor_col);

	}
}


//Testing function
void test1() {
 	strcpy(message, "BENJAMIN MOCK");
	display_message();
	return;
}
